<!DOCTYPE html>
<html lang="ja" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Easy Discord Bot Builder v5.3.3</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect x='4' y='4' width='56' height='56' rx='16' fill='%236366f1' /%3E%3Cpath d='M20 42 Q32 52 44 42' stroke='white' stroke-width='4' fill='none' stroke-linecap='round' /%3E%3Ccircle cx='22' cy='26' r='6' fill='white' /%3E%3Ccircle cx='42' cy='26' r='6' fill='white' /%3E%3C/svg%3E">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            750: '#2d3748',
                            850: '#1a202c',
                            950: '#020617',
                        },
                        indigo: {
                            450: '#818cf8',
                            550: '#6366f1',
                        }
                    },
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'Fira Code', 'Consolas', 'monospace'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 15px rgba(99, 102, 241, 0.3)',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Blockly -->
    <script src="https://unpkg.com/blockly@9.0.0/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly@9.0.0/python_compressed.js"></script>
    <script src="https://unpkg.com/blockly@9.0.0/msg/ja.js"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Syntax Highlight -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark-reasonable.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js"></script>

    <style>
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 24px 24px;
        }
        .dark body {
            background-image: radial-gradient(#1e293b 1px, transparent 1px);
        }
        
        /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ¶å¾¡ */
        #workspace-container {
            display: flex;
            width: 100%;
            height: 100%;
            position: relative;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            backdrop-filter: blur(8px);
        }

        #blocklyDiv {
            flex-grow: 1;
            height: 100%;
            position: relative;
            z-index: 10;
            transition: width 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        #liveCodeArea {
            width: 0;
            height: 100%;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0;
            overflow: hidden;
            transition: width 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.3s ease;
            opacity: 0;
            display: flex;
            flex-direction: column;
            border-left: 1px solid rgba(255,255,255,0.1);
        }

        /* åˆ†å‰²ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .split-view #blocklyDiv {
            width: 55%;
            flex-grow: 0;
            flex-shrink: 0;
            border-right: 1px solid rgba(0,0,0,0.05);
        }
        .dark .split-view #blocklyDiv {
            border-right: 1px solid rgba(255,255,255,0.05);
        }
        .split-view #liveCodeArea {
            width: 45%;
            opacity: 1;
            flex-grow: 1;
            box-shadow: inset 10px 0 20px -10px rgba(0,0,0,0.5);
        }

        #codePreviewContent {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            padding: 1.5rem;
            overflow-y: auto;
            height: 100%;
            background: transparent !important;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        
        #liveCodeArea ::-webkit-scrollbar-track { background: transparent; }
        #liveCodeArea ::-webkit-scrollbar-thumb { background: #334155; }
        #liveCodeArea ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Blockly Styling Overrides */
        .blocklyToolboxDiv {
            background-color: rgba(248, 250, 252, 0.95) !important;
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(0,0,0,0.05);
            padding-top: 1rem;
        }
        .dark .blocklyToolboxDiv {
            background-color: rgba(15, 23, 42, 0.95) !important;
            border-right: 1px solid rgba(255,255,255,0.05);
        }

        .blocklyTreeLabel {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-weight: 600;
            padding: 10px 0;
            font-size: 0.9rem;
            color: #475569;
        }
        
        .blocklyTreeRow {
            height: 48px !important;
            line-height: 48px !important;
            padding-left: 20px !important;
            border-left: 4px solid transparent;
            margin-bottom: 4px;
            transition: all 0.2s ease;
            margin-right: 12px;
            border-radius: 0 12px 12px 0;
        }
        
        .blocklyTreeRow:not(.blocklyTreeSelected):hover {
            background-color: #f1f5f9;
            border-left-color: #cbd5e1;
        }
        .blocklyTreeSelected {
            background-color: #e0e7ff !important;
            border-left-color: #6366f1 !important;
            color: #4f46e5 !important;
        }
        .blocklyTreeSelected .blocklyTreeLabel {
            color: #4f46e5 !important;
        }

        .dark .blocklyTreeLabel { color: #94a3b8; }
        .dark .blocklyTreeRow:not(.blocklyTreeSelected):hover {
            background-color: #1e293b;
            border-left-color: #475569;
        }
        .dark .blocklyTreeSelected {
            background-color: #1e1b4b !important;
            border-left-color: #818cf8 !important;
            color: #c7d2fe !important;
        }
        .dark .blocklyTreeSelected .blocklyTreeLabel {
            color: #c7d2fe !important;
        }

        .blocklyFlyoutBackground {
            fill: #ffffff !important;
            fill-opacity: 0.95;
        }
        .dark .blocklyFlyoutBackground {
            fill: #0f172a !important;
            fill-opacity: 0.95;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .modal-backdrop {
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .modal-backdrop.show-modal {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            transform: scale(0.95) translateY(10px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .show-modal .modal-content {
            transform: scale(1) translateY(0);
            opacity: 1;
        }
        
        /* Utility */
        .glass-header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        .dark .glass-header {
            background: rgba(15, 23, 42, 0.8);
        }

        /* Code Block Styling in Modal */
        .hljs {
            background: transparent !important;
            padding: 0 !important;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 dark:bg-slate-950 dark:text-slate-200 flex flex-col h-screen overflow-hidden transition-colors duration-500">

    <!-- Header -->
    <header class="glass-header shadow-soft border-b border-slate-200/50 dark:border-slate-800/50 px-6 py-3 flex justify-between items-center z-30 shrink-0 h-18 relative">
        <div class="flex items-center gap-4">
            <div class="relative group">
                <div class="absolute -inset-1 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl blur opacity-25 group-hover:opacity-50 transition duration-200"></div>
                <div class="relative bg-white dark:bg-slate-900 p-2.5 rounded-xl shadow-sm border border-slate-100 dark:border-slate-800 flex items-center justify-center">
                    <i data-lucide="bot" class="w-6 h-6 text-indigo-600 dark:text-indigo-400"></i>
                </div>
            </div>
            <div class="flex flex-col">
                <h1 class="text-xl font-bold text-slate-900 dark:text-white leading-tight tracking-tight flex items-center gap-3">
                    Easy Discord Bot Builder 
                    <span class="text-[10px] px-2 py-0.5 rounded-full bg-gradient-to-r from-indigo-500/10 to-purple-500/10 border border-indigo-500/20 text-indigo-600 dark:text-indigo-400 font-mono font-bold">v5.3.3</span>
                </h1>
                <p class="text-[11px] font-medium text-slate-500 dark:text-slate-400 mt-0.5 flex items-center gap-1">
                    Create by himais0giiiin!
                </p>
            </div>
        </div>

        <div class="flex items-center gap-3">
            <div id="saveStatus" class="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 text-xs font-bold opacity-0 transition-all duration-500 transform translate-y-2 data-[show=true]:translate-y-0 data-[show=true]:opacity-100">
                <i data-lucide="check-circle-2" class="w-3.5 h-3.5"></i>
                <span>Saved</span>
            </div>

            <div class="h-6 w-px bg-slate-200 dark:bg-slate-800 mx-1 hidden md:block"></div>

            <!-- Layout Switcher -->
            <div class="hidden md:flex items-center bg-slate-100 dark:bg-slate-900 p-1 rounded-lg border border-slate-200 dark:border-slate-800">
                <button id="layoutBlockBtn" class="flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-bold transition-all shadow-sm bg-white dark:bg-slate-800 text-indigo-600 dark:text-indigo-400" title="ãƒ–ãƒ­ãƒƒã‚¯ã®ã¿è¡¨ç¤º">
                    <i data-lucide="blocks" class="w-3.5 h-3.5"></i><span>Blocks</span>
                </button>
                <button id="layoutSplitBtn" class="flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-bold transition-all text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200" title="ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒ¼ãƒ‰è¡¨ç¤º">
                    <i data-lucide="columns" class="w-3.5 h-3.5"></i><span>Split</span>
                </button>
            </div>

            <!-- Actions -->
            <div class="flex items-center gap-1 bg-white dark:bg-slate-900 rounded-lg p-1 border border-slate-200 dark:border-slate-800 shadow-sm">
                <button id="importBtn" class="p-2 text-slate-500 hover:text-indigo-600 dark:text-slate-400 dark:hover:text-indigo-400 transition-colors rounded-md hover:bg-slate-50 dark:hover:bg-slate-800" title="Load XML">
                    <i data-lucide="upload" class="w-4.5 h-4.5"></i>
                </button>
                <button id="exportBtn" class="p-2 text-slate-500 hover:text-indigo-600 dark:text-slate-400 dark:hover:text-indigo-400 transition-colors rounded-md hover:bg-slate-50 dark:hover:bg-slate-800" title="Save XML">
                    <i data-lucide="download" class="w-4.5 h-4.5"></i>
                </button>
                
                <!-- Documentation Button -->
                <a href="https://github.com/himais0giiiin/easy-bdc/wiki/Docs" target="_blank" rel="noopener noreferrer" class="p-2 text-slate-500 hover:text-indigo-600 dark:text-slate-400 dark:hover:text-indigo-400 transition-colors rounded-md hover:bg-slate-50 dark:hover:bg-slate-800" title="Documentation">
                    <i data-lucide="book-open" class="w-4.5 h-4.5"></i>
                </a>

                <div class="w-px h-4 bg-slate-200 dark:bg-slate-700 mx-1"></div>
                <button id="themeToggle" class="p-2 text-slate-500 hover:text-amber-500 dark:text-slate-400 dark:hover:text-amber-400 transition-colors rounded-md hover:bg-slate-50 dark:hover:bg-slate-800">
                    <i data-lucide="moon" class="hidden w-4.5 h-4.5 dark:block"></i>
                    <i data-lucide="sun" class="block w-4.5 h-4.5 dark:hidden"></i>
                </button>
            </div>
            
            <input type="file" id="importInput" accept=".xml" class="hidden">

            <!-- Generate Code Button -->
            <button id="showCodeBtn" class="ml-2 group relative inline-flex items-center justify-center gap-2 px-5 py-2.5 font-semibold text-white transition-all duration-200 bg-indigo-600 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-600 active:scale-95 shadow-lg shadow-indigo-500/20 hover:shadow-indigo-500/40">
                <i data-lucide="code-2" class="w-4 h-4 transition-transform group-hover:rotate-6"></i>
                <span class="hidden sm:inline">ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</span>
            </button>
        </div>
    </header>

    <!-- Main Workspace -->
    <main class="relative w-full h-full overflow-hidden flex-grow flex">
        <div id="workspace-container">
            <!-- Block Editor -->
            <div id="blocklyDiv"></div>
            
            <!-- Live Code Preview (Split Mode Only) -->
            <div id="liveCodeArea">
                <div class="flex items-center justify-between px-4 py-3 bg-[#0f172a] border-b border-slate-700/50 shrink-0">
                    <div class="flex items-center gap-3">
                        <span class="flex items-center gap-2 text-xs font-mono text-indigo-300 bg-indigo-500/10 px-2 py-1 rounded border border-indigo-500/20">
                            <i data-lucide="file-code" class="w-3.5 h-3.5"></i> bot.py
                        </span>
                        <span class="text-[10px] text-slate-500 font-semibold uppercase tracking-widest">Read Only</span>
                    </div>
                    <div class="flex gap-1.5">
                        <div class="w-2.5 h-2.5 rounded-full bg-red-500/20 border border-red-500/50"></div>
                        <div class="w-2.5 h-2.5 rounded-full bg-yellow-500/20 border border-yellow-500/50"></div>
                        <div class="w-2.5 h-2.5 rounded-full bg-green-500/20 border border-green-500/50"></div>
                    </div>
                </div>
                <div class="relative flex-grow bg-[#0f172a] shadow-inner">
                    <div class="absolute inset-0 overflow-hidden">
                        <pre id="codePreviewContent" class="hljs python"></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toolbox Definition -->
        <xml id="toolbox" style="display: none">
            <category name="ã‚¤ãƒ™ãƒ³ãƒˆ" colour="#e67e22">
                <block type="on_ready"></block>
                <block type="on_message_create"></block>
                <block type="on_command_executed"></block>
                <block type="prefix_command"></block>
                <block type="get_message_content"></block>
                <block type="get_command_arg"></block>
            </category>
            
            <category name="ãƒœã‚¿ãƒ³ãƒ»ãƒ•ã‚©ãƒ¼ãƒ " colour="#d63031">
                <block type="send_button_message"></block>
                <block type="on_button_click"></block>
                <block type="show_modal"></block>
                <block type="on_modal_submit"></block>
                <block type="get_input_value"></block>
            </category>

            <category name="ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³" colour="#e17055">
                <block type="on_reaction_add"></block>
                <block type="add_reaction"></block>
            </category>
            
            <category name="æƒ…å ±å–å¾—" colour="#8e44ad">
                <block type="get_user_info"></block>
                <block type="get_member_detail"></block>
                <block type="member_has_role"></block>
                <block type="get_channel_info"></block>
                <block type="get_server_info"></block>
                <block type="get_current_time"></block>
            </category>

            <category name="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸" colour="#3498db">
                <block type="reply_message"></block>
                <block type="defer_reply"></block>
                <block type="send_channel_message"></block>
                <block type="edit_reply"></block>
                <block type="edit_message_by_id"></block>
                <block type="delete_message"></block>
                <block type="purge_messages"></block>
                <block type="pin_message"></block>
                <block type="create_thread"></block>
            </category>
            
            <category name="é«˜åº¦ãªæ“ä½œ" colour="#535c68">
                <block type="custom_python_code"></block>
                <block type="wait_for_message"></block>
                <block type="print_to_console"></block>
            </category>

            <category name="ãƒ‡ãƒ¼ã‚¿ä¿å­˜ (JSON)" colour="#d35400">
                <block type="json_load"></block>
                <block type="json_save"></block>
                <block type="dict_create"></block>
                <block type="dict_get"></block>
                <block type="dict_set"></block>
            </category>

            <category name="ãƒãƒ£ãƒ³ãƒãƒ«ãƒ»ãƒœã‚¤ã‚¹" colour="#00a8ff">
                <block type="join_voice_channel"></block>
                <block type="leave_voice_channel"></block>
                <block type="create_text_channel"></block>
                <block type="delete_channel"></block>
            </category>

            <category name="Botè¨­å®š" colour="#9b59b6">
                <block type="set_bot_status"></block>
                <block type="wait_seconds"></block>
            </category>

            <category name="ç®¡ç†æ©Ÿèƒ½" colour="#e74c3c">
                <block type="timeout_user"></block>
                <block type="kick_user"></block>
                <block type="ban_user"></block>
                <block type="add_user_role"></block>
                <block type="remove_user_role"></block>
                <block type="create_role"></block>
                <block type="change_nickname"></block>
            </category>
            
            <category name="åŸ‹ã‚è¾¼ã¿ (Embed)" colour="#2ecc71">
                <block type="create_embed"></block>
                <block type="set_embed_property"></block>
                <block type="add_embed_field"></block>
            </category>

            <sep></sep>
            
            <category name="å¤‰æ•°" colour="#a55b6a" custom="VARIABLE"></category>

            <category name="ãƒ‡ãƒ¼ã‚¿æ§‹é€ " colour="#a55b80">
                <block type="lists_create_with"></block>
                <block type="lists_length"></block>
                <block type="lists_getIndex"></block>
                <block type="lists_setIndex"></block>
                <block type="lists_append_to"></block>
                <block type="random_choice"></block>
            </category>
            
            <category name="é–¢æ•°" colour="#7b5ba5" custom="PROCEDURE"></category>

            <sep></sep>

            <category name="è«–ç†ãƒ»æ¯”è¼ƒ" colour="#f1c40f">
                <block type="controls_if"></block>
                <block type="logic_compare"></block>
                <block type="logic_operation"></block>
                <block type="logic_negate"></block>
                <block type="logic_boolean"></block>
            </category>

            <category name="ç¹°ã‚Šè¿”ã—" colour="#5b67a5">
                <block type="controls_repeat_ext"></block>
                <block type="controls_whileUntil"></block>
            </category>

            <category name="ç®—è¡“ãƒ»ä¹±æ•°" colour="#5b80a5">
                <block type="math_number"></block>
                <block type="math_arithmetic"></block>
                <block type="math_single"></block>
                <block type="math_round"></block>
                <block type="random_integer"></block>
            </category>

            <category name="æ–‡å­—åˆ—" colour="#5ba58c">
                <block type="text"></block>
                <block type="text_join"></block>
                <block type="text_length"></block>
                <block type="text_replace"></block>
                <block type="text_charAt"></block>
                <block type="text_print"></block>
            </category>
        </xml>
    </main>

    <!-- Code Generation Modal -->
    <div id="codeModal" class="modal-backdrop fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm">
        <div class="flex flex-col w-full max-w-4xl max-h-[85vh] overflow-hidden rounded-2xl shadow-2xl bg-white dark:bg-slate-900 modal-content border border-white/20 dark:border-slate-700/50 ring-1 ring-black/5">
            <!-- Modal Header -->
            <div class="flex items-center justify-between px-6 py-4 border-b border-slate-100 dark:border-slate-800 bg-white/50 dark:bg-slate-900/50 backdrop-blur-md sticky top-0 z-10">
                <div class="flex items-center gap-3">
                    <div class="p-2 rounded-lg bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400">
                        <i data-lucide="file-code-2" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <h2 class="text-lg font-bold text-slate-800 dark:text-white">Botã‚³ãƒ¼ãƒ‰ (Python)</h2>
                        <p class="text-xs text-slate-500 dark:text-slate-400">Generate your discord bot code</p>
                    </div>
                </div>
                <button id="closeModalBtn" class="p-2 transition-all rounded-lg text-slate-400 hover:text-slate-600 hover:bg-slate-100 dark:hover:text-slate-200 dark:hover:bg-slate-800">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="flex-grow p-6 overflow-y-auto bg-slate-50/50 dark:bg-slate-950/50">
                <div class="mb-6 p-5 rounded-xl border border-indigo-100 dark:border-indigo-900/50 bg-white dark:bg-slate-900 shadow-sm">
                    <h3 class="flex items-center gap-2 font-bold text-indigo-900 dark:text-indigo-300 mb-3">
                        <i data-lucide="info" class="w-4 h-4"></i> å®Ÿè¡Œæ–¹æ³•
                    </h3>
                    <ol class="space-y-2 text-sm text-slate-600 dark:text-slate-400 list-decimal list-inside font-medium">
                        <li>ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ <code class="px-1.5 py-0.5 rounded-md border border-indigo-200 dark:border-indigo-800 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300 font-mono">bot.py</code> ã¨ã„ã†åå‰ã§ä¿å­˜ã—ã¾ã™ã€‚</li>
                        <li>ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ <code class="px-1.5 py-0.5 rounded-md border border-indigo-200 dark:border-indigo-800 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300 font-mono select-all">pip install discord.py</code> ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</li>
                        <li><code class="px-1.5 py-0.5 rounded-md border border-indigo-200 dark:border-indigo-800 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300 font-mono select-all">python bot.py</code> ã‚’å®Ÿè¡Œã—ã¦Botã‚’èµ·å‹•ã—ã¾ã™ã€‚</li>
                    </ol>
                </div>

                <div class="relative group rounded-xl overflow-hidden shadow-lg border border-slate-200 dark:border-slate-800">
                    <div class="absolute top-3 right-3 z-10 opacity-0 transition-opacity duration-200 group-hover:opacity-100">
                        <button id="copyCodeBtn" class="flex items-center gap-1.5 px-4 py-2 text-xs font-bold text-white rounded-lg shadow-lg bg-indigo-600 hover:bg-indigo-500 border border-indigo-400 backdrop-blur-sm transition-all active:scale-95">
                            <i data-lucide="copy" class="w-3.5 h-3.5"></i> ã‚³ãƒ”ãƒ¼
                        </button>
                    </div>
                    <pre id="codeOutput" class="p-5 text-sm font-mono tab-4 bg-[#0f172a] text-[#e2e8f0] overflow-x-auto min-h-[300px]"></pre>
                </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="flex items-center justify-center gap-2 p-4 text-xs font-medium text-center text-amber-600 dark:text-amber-500 bg-amber-50 dark:bg-amber-900/10 border-t border-amber-100 dark:border-amber-900/20">
                <i data-lucide="shield-alert" class="w-4 h-4"></i>
                <span>Tokenã¯Discord Developer Portalã‹ã‚‰å–å¾—ã—ã€ä»–äººã«ã¯çµ¶å¯¾ã«æ•™ãˆãªã„ã§ãã ã•ã„ã€‚</span>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        let workspace;
        const STORAGE_KEY = 'discord_bot_builder_workspace_v5';

        // --- Custom Block Definition (Pythonã‚³ãƒ¼ãƒ‰ç›´æ¥è¨˜è¿°) ---
        Blockly.Blocks['custom_python_code'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("ğŸ Pythonã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ");
                this.appendDummyInput()
                    .appendField(new Blockly.FieldMultilineInput("print('Hello World')"), "CODE");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour(60);
                this.setTooltip("ä»»æ„ã®Pythonã‚³ãƒ¼ãƒ‰ã‚’ã“ã“ã«è¨˜è¿°ã—ã¦å®Ÿè¡Œã•ã›ã¾ã™ã€‚");
            }
        };

        const setupBlocklyEnvironment = () => {
            // Modern Theme Definition
            const modernLightTheme = Blockly.Theme.defineTheme('modernLight', {
                'base': Blockly.Themes.Classic,
                'componentStyles': {
                    'workspaceBackgroundColour': '#f8fafc', // slate-50
                    'toolboxBackgroundColour': '#ffffff',
                    'toolboxForegroundColour': '#475569',
                    'flyoutBackgroundColour': '#ffffff',
                    'flyoutForegroundColour': '#475569',
                    'flyoutOpacity': 0.95,
                    'scrollbarColour': '#cbd5e1',
                    'insertionMarkerColour': '#6366f1', // Indigo
                    'insertionMarkerOpacity': 0.3,
                    'cursorColour': '#6366f1',
                },
                'fontStyle': {
                    'family': 'Plus Jakarta Sans, sans-serif',
                    'weight': '600',
                    'size': 12
                }
            });

            const modernDarkTheme = Blockly.Theme.defineTheme('modernDark', {
                'base': Blockly.Themes.Classic,
                'componentStyles': {
                    'workspaceBackgroundColour': '#020617', // slate-950
                    'toolboxBackgroundColour': '#0f172a', // slate-900
                    'toolboxForegroundColour': '#cbd5e1',
                    'flyoutBackgroundColour': '#0f172a',
                    'flyoutForegroundColour': '#cbd5e1',
                    'flyoutOpacity': 0.95,
                    'scrollbarColour': '#334155',
                    'insertionMarkerColour': '#818cf8', // Indigo light
                    'insertionMarkerOpacity': 0.3,
                    'cursorColour': '#818cf8',
                },
                'fontStyle': {
                    'family': 'Plus Jakarta Sans, sans-serif',
                    'weight': '600',
                    'size': 12
                },
                'blockStyles': {
                    'hat_blocks': {'colourPrimary': '#a55b80'}
                }
            });

            Blockly.Python.INDENT = '    ';
            
            // --- Custom Block Generator (å†…å®¹ã¯å¤‰æ›´ãªã—) ---
            Blockly.Python['custom_python_code'] = function(block) {
                const code = block.getFieldValue('CODE');
                return code + '\n';
            };

            // Existing Block Definitions (å†…å®¹å¤‰æ›´ãªã—)
            Blockly.Blocks['on_ready'] = { init: function() { this.appendDummyInput().appendField("ğŸ BotãŒèµ·å‹•ã—ãŸã¨ã"); this.appendStatementInput("DO").setCheck(null).appendField("å®Ÿè¡Œã™ã‚‹å‡¦ç†"); this.setColour(30); this.setTooltip("Botã®ãƒ­ã‚°ã‚¤ãƒ³ãŒå®Œäº†ã—ã€æº–å‚™ãŒã§ããŸæ™‚ã«1å›ã ã‘å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚"); } };
            Blockly.Blocks['on_message_create'] = { init: function() { this.appendDummyInput().appendField("ğŸ“© ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã—ãŸã¨ã"); this.appendStatementInput("DO").setCheck(null).appendField("å®Ÿè¡Œã™ã‚‹å‡¦ç†"); this.setColour(30); this.setTooltip("èª°ã‹ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ãŸæ™‚ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚"); } };
            Blockly.Blocks['get_message_content'] = { init: function() { this.appendDummyInput().appendField("å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹"); this.setOutput(true, "String"); this.setColour(30); } };
            Blockly.Blocks['on_command_executed'] = { init: function() { this.appendDummyInput().appendField("âš¡ ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ /").appendField(new Blockly.FieldTextInput("hello"), "COMMAND_NAME").appendField("ã‚’ä½¿ã‚ã‚ŒãŸã¨ã"); this.appendStatementInput("DO").setCheck(null).appendField("å®Ÿè¡Œã™ã‚‹å‡¦ç†"); this.setColour(230); } };
            Blockly.Blocks['prefix_command'] = { init: function() { this.appendDummyInput().appendField("ğŸ—£ï¸ ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚³ãƒãƒ³ãƒ‰").appendField(new Blockly.FieldTextInput("!ping"), "COMMAND_NAME").appendField("ã‚’å®Ÿè¡Œã—ãŸã¨ã"); this.appendStatementInput("DO").setCheck(null).appendField("å®Ÿè¡Œã™ã‚‹å‡¦ç†"); this.setColour(230); } };
            Blockly.Blocks['get_command_arg'] = { init: function() { this.appendDummyInput().appendField("ã‚³ãƒãƒ³ãƒ‰å¼•æ•°").appendField(new Blockly.FieldTextInput("name"), "ARG_NAME").appendField("ã®å€¤"); this.setOutput(true, ["String", "Number"]); this.setColour(230); } };
            Blockly.Blocks['get_user_info'] = { init: function() { this.appendDummyInput().appendField("ğŸ‘¤ å®Ÿè¡Œè€…ã®").appendField(new Blockly.FieldDropdown([ ["ãƒ¦ãƒ¼ã‚¶ãƒ¼ID", "id"], ["åå‰ (ãƒ¦ãƒ¼ã‚¶ãƒ¼å)", "name"], ["è¡¨ç¤ºå (ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ )", "display_name"], ["ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ (<@ID>)", "mention"] ]), "TYPE"); this.setOutput(true, "String"); this.setColour(260); } };
            Blockly.Blocks['get_member_detail'] = { init: function() { this.appendDummyInput().appendField("ğŸ‘¤ å®Ÿè¡Œè€…ã®è©³ç´°:").appendField(new Blockly.FieldDropdown([ ["ã‚¢ãƒã‚¿ãƒ¼URL", "avatar.url"], ["ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæ—¥", "created_at"], ["ã‚µãƒ¼ãƒãƒ¼å‚åŠ æ—¥", "joined_at"], ["ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", "status"], ]), "TYPE"); this.setOutput(true, "String"); this.setColour(260); } };
            Blockly.Blocks['get_channel_info'] = { init: function() { this.appendDummyInput().appendField("ğŸ“º ç¾åœ¨ã®").appendField(new Blockly.FieldDropdown([ ["ãƒãƒ£ãƒ³ãƒãƒ«ID", "id"], ["ãƒãƒ£ãƒ³ãƒãƒ«å", "name"], ["ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ (<#ID>)", "mention"] ]), "TYPE"); this.setOutput(true, "String"); this.setColour(260); } };
            Blockly.Blocks['get_server_info'] = { init: function() { this.appendDummyInput().appendField("ğŸŒ ã‚µãƒ¼ãƒãƒ¼ã®").appendField(new Blockly.FieldDropdown([ ["ã‚µãƒ¼ãƒãƒ¼ID", "id"], ["ã‚µãƒ¼ãƒãƒ¼å", "name"], ["ãƒ¡ãƒ³ãƒãƒ¼æ•°", "member_count"] ]), "TYPE"); this.setOutput(true, ["String", "Number"]); this.setColour(260); } };
            Blockly.Blocks['member_has_role'] = { init: function() { this.appendValueInput("USER").setCheck("String").appendField("â“ ãƒ¦ãƒ¼ã‚¶ãƒ¼"); this.appendValueInput("ROLE_ID").setCheck("String").appendField("ãŒãƒ­ãƒ¼ãƒ«(ID)"); this.appendDummyInput().appendField("ã‚’æŒã£ã¦ã„ã‚‹"); this.setOutput(true, "Boolean"); this.setColour(260); } };
            Blockly.Blocks['get_current_time'] = { init: function() { this.appendDummyInput().appendField("ğŸ•’ ç¾åœ¨æ™‚åˆ» (æ–‡å­—åˆ—)"); this.setOutput(true, "String"); this.setColour(260); } };
            Blockly.Blocks['reply_message'] = { init: function() { this.appendValueInput("MESSAGE").setCheck(["String", "Embed"]).appendField("â†©ï¸ è¿”ä¿¡ã™ã‚‹"); this.appendDummyInput().appendField("è‡ªåˆ†ã ã‘ã«è¡¨ç¤º").appendField(new Blockly.FieldCheckbox("FALSE"), "EPHEMERAL"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(160); } };
            Blockly.Blocks['defer_reply'] = { init: function() { this.appendDummyInput().appendField("â³ å¿œç­”ã‚’ä¿ç•™ã™ã‚‹ (è€ƒãˆä¸­...)").appendField("è‡ªåˆ†ã ã‘").appendField(new Blockly.FieldCheckbox("FALSE"), "EPHEMERAL"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(160); } };
            Blockly.Blocks['edit_reply'] = { init: function() { this.appendValueInput("MESSAGE").setCheck(["String", "Embed"]).appendField("âœï¸ è¿”ä¿¡ã‚’ç·¨é›†ã™ã‚‹"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(160); } };
            Blockly.Blocks['edit_message_by_id'] = { init: function() { this.appendValueInput("CHANNEL_ID").setCheck("String").appendField("âœï¸ ç·¨é›†: ãƒãƒ£ãƒ³ãƒãƒ«ID"); this.appendValueInput("MESSAGE_ID").setCheck("String").appendField("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID"); this.appendValueInput("CONTENT").setCheck("String").appendField("æ–°ã—ã„å†…å®¹"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(160); } };
            Blockly.Blocks['send_channel_message'] = { init: function() { this.appendValueInput("CHANNEL_ID").setCheck("String").appendField("#ï¸âƒ£ ãƒãƒ£ãƒ³ãƒãƒ«ID"); this.appendValueInput("MESSAGE").setCheck(["String", "Embed"]).appendField("ã«é€ä¿¡"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(160); } };
            Blockly.Blocks['delete_message'] = { init: function() { this.appendDummyInput().appendField("ğŸ—‘ï¸ ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(160); } };
            Blockly.Blocks['purge_messages'] = { init: function() { this.appendValueInput("LIMIT").setCheck("Number").appendField("ğŸ—‘ï¸ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¸€æ‹¬å‰Šé™¤ï¼ˆ"); this.appendDummyInput().appendField("ä»¶ï¼‰"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(160); } };
            Blockly.Blocks['pin_message'] = { init: function() { this.appendDummyInput().appendField("ğŸ“Œ ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ”ãƒ³ç•™ã‚"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(160); } };
            Blockly.Blocks['add_reaction'] = { init: function() { this.appendValueInput("EMOJI").setCheck("String").appendField("ğŸ‘ ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(160); } };
            Blockly.Blocks['create_thread'] = { init: function() { this.appendValueInput("NAME").setCheck("String").appendField("ğŸ§µ ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆï¼ˆåå‰"); this.appendDummyInput().appendField("ï¼‰"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(160); } };
            Blockly.Blocks['wait_for_message'] = { init: function() { this.appendValueInput("TIMEOUT").setCheck("Number").appendField("â³ è¿”ä¿¡ã‚’å¾…ã¤ (æœ€å¤§"); this.appendDummyInput().appendField("ç§’)"); this.setOutput(true, "String"); this.setColour(290); } };
            Blockly.Blocks['print_to_console'] = { init: function() { this.appendValueInput("TEXT").setCheck(null).appendField("ğŸ–¨ï¸ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤º"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(160); } };
            Blockly.Blocks['join_voice_channel'] = { init: function() { this.appendDummyInput().appendField("ğŸ”Š å®Ÿè¡Œè€…ã®ãƒœã‚¤ã‚¹ãƒãƒ£ãƒ³ãƒãƒ«ã«å‚åŠ "); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(340); } };
            Blockly.Blocks['leave_voice_channel'] = { init: function() { this.appendDummyInput().appendField("ğŸ”‡ ãƒœã‚¤ã‚¹ãƒãƒ£ãƒ³ãƒãƒ«ã‹ã‚‰åˆ‡æ–­"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(340); } };
            Blockly.Blocks['create_text_channel'] = { init: function() { this.appendValueInput("NAME").setCheck("String").appendField("ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ£ãƒ³ãƒãƒ«ä½œæˆ"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(340); } };
            Blockly.Blocks['delete_channel'] = { init: function() { this.appendValueInput("CHANNEL_ID").setCheck("String").appendField("ğŸ—‘ï¸ ãƒãƒ£ãƒ³ãƒãƒ«å‰Šé™¤ (ID"); this.appendDummyInput().appendField(")"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(340); } };
            Blockly.Blocks['set_bot_status'] = { init: function() { this.appendValueInput("STATUS").setCheck("String").appendField("ğŸ® ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’"); this.appendDummyInput().appendField(new Blockly.FieldDropdown([ ["ãƒ—ãƒ¬ã‚¤ä¸­", "playing"], ["è¦–è´ä¸­", "watching"], ["å†ç”Ÿä¸­", "listening"], ]), "TYPE").appendField("ã«ã™ã‚‹"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(260); } };
            Blockly.Blocks['wait_seconds'] = { init: function() { this.appendValueInput("SECONDS").setCheck("Number").appendField("â³"); this.appendDummyInput().appendField("ç§’å¾…ã¤"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(260); } };
            Blockly.Blocks['create_embed'] = { init: function() { this.appendDummyInput().appendField("âœ¨ æ–°ã—ã„åŸ‹ã‚è¾¼ã¿(Embed)ä½œæˆ"); this.appendStatementInput("PROPERTIES").setCheck(null); this.setOutput(true, "Embed"); this.setColour(100); } };
            Blockly.Blocks['set_embed_property'] = { init: function() { this.appendValueInput("VALUE").setCheck("String").appendField("è¨­å®šï¼š").appendField(new Blockly.FieldDropdown([ ["ã‚¿ã‚¤ãƒˆãƒ«", "title"], ["èª¬æ˜æ–‡", "description"], ["è‰² (0xHex)", "color"], ["ç”»åƒURL", "image"], ]), "PROPERTY"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(100); } };
            Blockly.Blocks['add_embed_field'] = { init: function() { this.appendValueInput("NAME").setCheck("String").appendField("é …ç›®å"); this.appendValueInput("VALUE").setCheck("String").appendField("å†…å®¹"); this.appendDummyInput().appendField("æ¨ªä¸¦ã³").appendField(new Blockly.FieldCheckbox("TRUE"), "INLINE"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(100); } };
            Blockly.Blocks['kick_user'] = { init: function() { this.appendValueInput("USER_ID").setCheck("String").appendField("ğŸ‘¢ Kickã™ã‚‹ (ID"); this.appendValueInput("REASON").setCheck("String").appendField("ç†ç”±"); this.appendDummyInput().appendField(")"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(0); } };
            Blockly.Blocks['ban_user'] = { init: function() { this.appendValueInput("USER_ID").setCheck("String").appendField("ğŸš« BANã™ã‚‹ (ID"); this.appendValueInput("REASON").setCheck("String").appendField("ç†ç”±"); this.appendDummyInput().appendField(")"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(0); } };
            Blockly.Blocks['timeout_user'] = { init: function() { this.appendValueInput("USER_ID").setCheck("String").appendField("ğŸ”‡ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ (ID"); this.appendValueInput("MINUTES").setCheck("Number").appendField("åˆ†"); this.appendDummyInput().appendField("é–“)"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(0); } };
            Blockly.Blocks['add_user_role'] = { init: function() { this.appendValueInput("USER_ID").setCheck("String").appendField("â• ãƒ­ãƒ¼ãƒ«ä»˜ä¸ (ãƒ¦ãƒ¼ã‚¶ãƒ¼ID"); this.appendValueInput("ROLE_ID").setCheck("String").appendField("ãƒ­ãƒ¼ãƒ«ID"); this.appendDummyInput().appendField(")"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(0); } };
            Blockly.Blocks['remove_user_role'] = { init: function() { this.appendValueInput("USER_ID").setCheck("String").appendField("â– ãƒ­ãƒ¼ãƒ«å‰¥å¥ª (ãƒ¦ãƒ¼ã‚¶ãƒ¼ID"); this.appendValueInput("ROLE_ID").setCheck("String").appendField("ãƒ­ãƒ¼ãƒ«ID"); this.appendDummyInput().appendField(")"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(0); } };
            Blockly.Blocks['create_role'] = { init: function() { this.appendValueInput("NAME").setCheck("String").appendField("ğŸ”° æ–°è¦ãƒ­ãƒ¼ãƒ«ä½œæˆ (åå‰"); this.appendDummyInput().appendField(")"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(0); } };
            Blockly.Blocks['change_nickname'] = { init: function() { this.appendValueInput("USER_ID").setCheck("String").appendField("ğŸ·ï¸ ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ å¤‰æ›´ (ID"); this.appendValueInput("NAME").setCheck("String").appendField("æ–°ã—ã„åå‰"); this.appendDummyInput().appendField(")"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(0); } };
            Blockly.Blocks['lists_append_to'] = { init: function() { this.appendValueInput('LIST').setCheck('Array').appendField('ãƒªã‚¹ãƒˆ'); this.appendValueInput('ITEM').setCheck(null).appendField('ã«é …ç›®'); this.appendDummyInput().appendField('ã‚’è¿½åŠ '); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(210); } };
            Blockly.Blocks['random_choice'] = { init: function() { this.appendValueInput("LIST").setCheck("Array").appendField("ğŸ² ãƒªã‚¹ãƒˆ"); this.appendDummyInput().appendField("ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«1ã¤é¸ã¶"); this.setOutput(true, null); this.setColour(230); } };
            Blockly.Blocks['random_integer'] = { init: function() { this.appendValueInput("FROM").setCheck("Number").appendField("ğŸ² ä¹±æ•° (æœ€å°"); this.appendValueInput("TO").setCheck("Number").appendField("ã€œ æœ€å¤§"); this.appendDummyInput().appendField(")"); this.setInputsInline(true); this.setOutput(true, "Number"); this.setColour(230); } };
            Blockly.Blocks['text_replace'] = { init: function() { this.appendValueInput("TEXT").setCheck("String").appendField("ãƒ†ã‚­ã‚¹ãƒˆ"); this.appendValueInput("FROM").setCheck("String").appendField("ã®ä¸­ã®"); this.appendValueInput("TO").setCheck("String").appendField("ã‚’"); this.appendDummyInput().appendField("ã«ç½®æ›ã™ã‚‹"); this.setInputsInline(true); this.setOutput(true, "String"); this.setColour(160); } };

            // New Blocks
            Blockly.Blocks['on_reaction_add'] = { init: function() { this.appendDummyInput().appendField("â­ ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒä»˜ã„ãŸã¨ã"); this.appendDummyInput().appendField("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID(ä»»æ„):").appendField(new Blockly.FieldTextInput(""), "MESSAGE_ID"); this.appendDummyInput().appendField("çµµæ–‡å­—(ä»»æ„):").appendField(new Blockly.FieldTextInput(""), "EMOJI"); this.appendStatementInput("DO").setCheck(null).appendField("å®Ÿè¡Œã™ã‚‹å‡¦ç†"); this.setColour(30); } };
            Blockly.Blocks['send_button_message'] = { init: function() { this.appendValueInput("MESSAGE").setCheck("String").appendField("ğŸ”˜ ãƒœã‚¿ãƒ³ä»˜ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡"); this.appendDummyInput().appendField("ãƒœã‚¿ãƒ³å").appendField(new Blockly.FieldTextInput("Click Me"), "LABEL"); this.appendDummyInput().appendField("ãƒœã‚¿ãƒ³ID").appendField(new Blockly.FieldTextInput("button_1"), "CUSTOM_ID"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(350); } };
            Blockly.Blocks['on_button_click'] = { init: function() { this.appendDummyInput().appendField("ğŸ–±ï¸ ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ã"); this.appendDummyInput().appendField("ãƒœã‚¿ãƒ³ID:").appendField(new Blockly.FieldTextInput("button_1"), "CUSTOM_ID"); this.appendStatementInput("DO").setCheck(null).appendField("å®Ÿè¡Œã™ã‚‹å‡¦ç†"); this.setColour(350); } };
            Blockly.Blocks['show_modal'] = { init: function() { this.appendDummyInput().appendField("ğŸ“ ãƒ¢ãƒ¼ãƒ€ãƒ«(å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ )ã‚’è¡¨ç¤º"); this.appendDummyInput().appendField("ã‚¿ã‚¤ãƒˆãƒ«:").appendField(new Blockly.FieldTextInput("My Form"), "TITLE"); this.appendDummyInput().appendField("ãƒ•ã‚©ãƒ¼ãƒ ID:").appendField(new Blockly.FieldTextInput("modal_1"), "CUSTOM_ID"); this.appendDummyInput().appendField("å…¥åŠ›é …ç›®1:").appendField(new Blockly.FieldTextInput("Name"), "LABEL1"); this.appendDummyInput().appendField("å…¥åŠ›é …ç›®2(ä»»æ„):").appendField(new Blockly.FieldTextInput(""), "LABEL2"); this.setPreviousStatement(true, null); this.setNextStatement(true, null); this.setColour(350); } };
            Blockly.Blocks['on_modal_submit'] = { init: function() { this.appendDummyInput().appendField("ğŸ“© ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé€ä¿¡ã•ã‚ŒãŸã¨ã"); this.appendDummyInput().appendField("ãƒ•ã‚©ãƒ¼ãƒ ID:").appendField(new Blockly.FieldTextInput("modal_1"), "CUSTOM_ID"); this.appendStatementInput("DO").setCheck(null).appendField("å®Ÿè¡Œã™ã‚‹å‡¦ç†"); this.setColour(350); } };
            Blockly.Blocks['get_input_value'] = { init: function() { this.appendDummyInput().appendField("å…¥åŠ›é …ç›®").appendField(new Blockly.FieldDropdown([ ["1ã¤ç›®", "0"], ["2ã¤ç›®", "1"] ]), "INDEX").appendField("ã®å€¤"); this.setOutput(true, "String"); this.setColour(350); } };

            // Code Generators (Include previous ones)
            const getBranchCode = (block, name) => {
                let code = Blockly.Python.statementToCode(block, name);
                if (!code || code.trim() === '') return Blockly.Python.INDENT + 'pass\n';
                return code;
            };

            Blockly.Python['on_ready'] = function(block) { const branch = getBranchCode(block, 'DO'); return `\n@bot.event\nasync def on_ready():\n    print(f'Logged in as {bot.user}')\n    try:\n        synced = await bot.tree.sync()\n        print(f"Synced {len(synced)} command(s)")\n    except Exception as e:\n        print(e)\n${branch.trimEnd()}\n`; };
            Blockly.Python['on_message_create'] = function(block) { const branch = getBranchCode(block, 'DO'); return `\n@bot.event\nasync def on_message(message):\n    if message.author == bot.user:\n        return\n    ctx = message\n    user = message.author\n${branch.trimEnd()}\n    await bot.process_commands(message)\n`; };
            Blockly.Python['get_message_content'] = function(block) { return ['(ctx.content if "ctx" in locals() and hasattr(ctx, "content") else "")', Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['on_command_executed'] = function(block) { const commandName = block.getFieldValue('COMMAND_NAME').toLowerCase(); const branch = getBranchCode(block, 'DO'); return `\n@bot.tree.command(name="${commandName}", description="${commandName} command")\nasync def ${commandName}_cmd(interaction: discord.Interaction):\n    ctx = interaction\n    user = interaction.user\n${branch.trimEnd()}\n`; };
            Blockly.Python['prefix_command'] = function(block) { const commandName = block.getFieldValue('COMMAND_NAME').replace(/^[!~#&?]/, ''); const branch = getBranchCode(block, 'DO'); return `\n@bot.command(name='${commandName}')\nasync def ${commandName}_cmd(ctx):\n    user = ctx.author\n${branch.trimEnd()}\n`; };
            Blockly.Python['get_command_arg'] = function(block) { const argName = block.getFieldValue('ARG_NAME'); return [`# Argument '${argName}' needed`, Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['get_user_info'] = function(block) { const type = block.getFieldValue('TYPE'); let code = `user.${type}`; if (type === 'name') code = 'user.name'; if (type === 'display_name') code = 'user.display_name'; return [`(${code} if "user" in locals() else "Unknown")`, Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['get_member_detail'] = function(block) { const type = block.getFieldValue('TYPE'); let code = `user.${type}`; if (type === 'avatar.url') code = 'str(user.avatar.url) if user.avatar else ""'; if (type === 'created_at') code = 'str(user.created_at.strftime("%Y-%m-%d %H:%M"))'; if (type === 'joined_at') code = 'str(user.joined_at.strftime("%Y-%m-%d %H:%M")) if hasattr(user, "joined_at") else ""'; if (type === 'status') code = 'str(user.status) if hasattr(user, "status") else "unknown"'; return [`(${code} if "user" in locals() else "Unknown")`, Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['get_channel_info'] = function(block) { const type = block.getFieldValue('TYPE'); let code = `ctx.channel.${type}`; return [`(${code} if "ctx" in locals() and hasattr(ctx, "channel") else "Unknown")`, Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['get_server_info'] = function(block) { const type = block.getFieldValue('TYPE'); let code = `ctx.guild.${type}`; return [`(${code} if "ctx" in locals() and ctx.guild else "Unknown")`, Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['member_has_role'] = function(block) { const userCode = Blockly.Python.valueToCode(block, 'USER', Blockly.Python.ORDER_NONE) || '0'; const roleId = Blockly.Python.valueToCode(block, 'ROLE_ID', Blockly.Python.ORDER_NONE) || '0'; const code = `(discord.utils.get(ctx.guild.get_member(int(${userCode})).roles, id=int(${roleId})) is not None if "ctx" in locals() and ctx.guild and str(${userCode}).isdigit() and str(${roleId}).isdigit() else False)`; return [code, Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['get_current_time'] = function(block) { return [`datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')`, Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['reply_message'] = function(block) { const msg = Blockly.Python.valueToCode(block, 'MESSAGE', Blockly.Python.ORDER_NONE) || '""'; const ephemeral = block.getFieldValue('EPHEMERAL') === 'TRUE' ? 'True' : 'False'; let contentCode = msg.startsWith('discord.Embed') ? `embed=${msg}` : `content=${msg}`; return `\nif 'ctx' in locals():\n    if isinstance(ctx, discord.Interaction):\n        if ctx.response.is_done():\n            await ctx.followup.send(${contentCode}, ephemeral=${ephemeral})\n        else:\n            await ctx.response.send_message(${contentCode}, ephemeral=${ephemeral})\n    elif isinstance(ctx, commands.Context):\n        await ctx.send(${contentCode})\n    elif isinstance(ctx, discord.Message):\n        await ctx.reply(${contentCode})\n`; };
            Blockly.Python['defer_reply'] = function(block) { const ephemeral = block.getFieldValue('EPHEMERAL') === 'TRUE' ? 'True' : 'False'; return `\nif 'ctx' in locals():\n    if isinstance(ctx, discord.Interaction):\n        await ctx.response.defer(ephemeral=${ephemeral})\n    elif isinstance(ctx, commands.Context):\n        async with ctx.typing(): pass\n`; };
            Blockly.Python['edit_reply'] = function(block) { const msg = Blockly.Python.valueToCode(block, 'MESSAGE', Blockly.Python.ORDER_NONE) || '""'; let contentCode = msg.startsWith('discord.Embed') ? `embed=${msg}` : `content=${msg}`; return `\nif 'ctx' in locals() and isinstance(ctx, discord.Interaction):\n    await ctx.edit_original_response(${contentCode})\n`; };
            Blockly.Python['edit_message_by_id'] = function(block) { const channelId = Blockly.Python.valueToCode(block, 'CHANNEL_ID', Blockly.Python.ORDER_NONE) || '0'; const messageId = Blockly.Python.valueToCode(block, 'MESSAGE_ID', Blockly.Python.ORDER_NONE) || '0'; const content = Blockly.Python.valueToCode(block, 'CONTENT', Blockly.Python.ORDER_NONE) || '""'; return `\ntry:\n    _ch = bot.get_channel(int(${channelId}))\n    if _ch:\n        _msg = await _ch.fetch_message(int(${messageId}))\n        if _msg: await _msg.edit(content=${content})\nexcept Exception as e:\n    print(f"Edit Error: {e}")\n`; };
            Blockly.Python['send_channel_message'] = function(block) { const channelId = Blockly.Python.valueToCode(block, 'CHANNEL_ID', Blockly.Python.ORDER_NONE) || '0'; const msg = Blockly.Python.valueToCode(block, 'MESSAGE', Blockly.Python.ORDER_NONE) || '""'; const contentArg = msg.startsWith('discord.Embed') ? `embed=${msg}` : `content=${msg}`; return `\n_ch_id = int(${channelId}) if str(${channelId}).isdigit() else 0\n_channel = bot.get_channel(_ch_id)\nif _channel:\n    await _channel.send(${contentArg})\n`; };
            Blockly.Python['delete_message'] = function(block) { return `\nif 'ctx' in locals():\n    if isinstance(ctx, discord.Message):\n        await ctx.delete()\n    elif isinstance(ctx, commands.Context):\n        await ctx.message.delete()\n`; };
            Blockly.Python['purge_messages'] = function(block) { const limit = Blockly.Python.valueToCode(block, 'LIMIT', Blockly.Python.ORDER_NONE) || '5'; return `\nif 'ctx' in locals() and hasattr(ctx, 'channel') and hasattr(ctx.channel, 'purge'):\n    await ctx.channel.purge(limit=int(${limit}))\n`; };
            Blockly.Python['pin_message'] = function(block) { return `\nif 'ctx' in locals():\n    if isinstance(ctx, discord.Message):\n        await ctx.pin()\n    elif isinstance(ctx, commands.Context):\n        await ctx.message.pin()\n`; };
            Blockly.Python['add_reaction'] = function(block) { const emoji = Blockly.Python.valueToCode(block, 'EMOJI', Blockly.Python.ORDER_NONE) || '"ğŸ‘"'; return `\ntry:\n    if 'ctx' in locals():\n        if isinstance(ctx, discord.Message): \n            await ctx.add_reaction(${emoji})\n        elif isinstance(ctx, commands.Context): \n            await ctx.message.add_reaction(${emoji})\nexcept Exception:\n    pass\n`; };
            Blockly.Python['create_thread'] = function(block) { const name = Blockly.Python.valueToCode(block, 'NAME', Blockly.Python.ORDER_NONE) || '"New Thread"'; return `\ntry:\n    if 'ctx' in locals():\n        if isinstance(ctx, discord.Message): \n            await ctx.create_thread(name=${name})\n        elif isinstance(ctx, commands.Context): \n            await ctx.message.create_thread(name=${name})\nexcept Exception:\n    pass\n`; };
            Blockly.Python['wait_for_message'] = function(block) { const timeout = Blockly.Python.valueToCode(block, 'TIMEOUT', Blockly.Python.ORDER_NONE) || '30'; const code = `\n(await bot.wait_for('message', check=lambda m: m.channel == ctx.channel and m.author == user, timeout=${timeout})).content\n`.trim(); return [code, Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['print_to_console'] = function(block) { const text = Blockly.Python.valueToCode(block, 'TEXT', Blockly.Python.ORDER_NONE) || '""'; return `print(${text})\n`; };
            Blockly.Python['join_voice_channel'] = function(block) { return `\nif 'user' in locals() and user.voice:\n    await user.voice.channel.connect()\n`; };
            Blockly.Python['leave_voice_channel'] = function(block) { return `\nif 'ctx' in locals() and ctx.guild.voice_client:\n    await ctx.guild.voice_client.disconnect()\n`; };
            Blockly.Python['create_text_channel'] = function(block) { const name = Blockly.Python.valueToCode(block, 'NAME', Blockly.Python.ORDER_NONE) || '"new-channel"'; return `\nif 'ctx' in locals() and ctx.guild:\n    await ctx.guild.create_text_channel(name=${name})\n`; };
            Blockly.Python['delete_channel'] = function(block) { const channelId = Blockly.Python.valueToCode(block, 'CHANNEL_ID', Blockly.Python.ORDER_NONE) || '0'; return `\n_ch = bot.get_channel(int(${channelId}))\nif _ch:\n    await _ch.delete()\n`; };
            Blockly.Python['set_bot_status'] = function(block) { const status = Blockly.Python.valueToCode(block, 'STATUS', Blockly.Python.ORDER_NONE) || '"Bot"'; const type = block.getFieldValue('TYPE'); let activityCode = `discord.Game(name=${status})`; if (type === 'watching') activityCode = `discord.Activity(type=discord.ActivityType.watching, name=${status})`; if (type === 'listening') activityCode = `discord.Activity(type=discord.ActivityType.listening, name=${status})`; return `await bot.change_presence(activity=${activityCode})\n`; };
            Blockly.Python['wait_seconds'] = function(block) { const sec = Blockly.Python.valueToCode(block, 'SECONDS', Blockly.Python.ORDER_NONE) || '1'; return `await asyncio.sleep(${sec})\n`; };
            Blockly.Python['create_embed'] = function(block) { const embedVarName = Blockly.Python.variableDB_.getDistinctName('embed', Blockly.Names.VARIABLE_NAME); let code = `\n${embedVarName} = discord.Embed(title="No Title", description="...", color=0x3498DB)\n`.trim() + '\n'; const propertiesCode = Blockly.Python.statementToCode(block, 'PROPERTIES'); const lines = propertiesCode.split('\n'); for (const line of lines) { if (!line.trim()) continue; if (line.includes('# EMBED_VAR_PLACEHOLDER')) { code += line.replace(/# EMBED_VAR_PLACEHOLDER/g, embedVarName) + '\n'; } else if (line.trim().startsWith('embed.')) { code += line.replace(/embed\./g, `${embedVarName}.`) + '\n'; } } return [`${embedVarName}`, Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['set_embed_property'] = function(block) { const property = block.getFieldValue('PROPERTY'); const value = Blockly.Python.valueToCode(block, 'VALUE', Blockly.Python.ORDER_NONE) || '""'; if (property === 'color') return `embed.color = ${value}\n`; if (property === 'image') return `embed.set_image(url=${value})\n`; if (property === 'title') return `embed.title = ${value}\n`; if (property === 'description') return `embed.description = ${value}\n`; return ''; };
            Blockly.Python['add_embed_field'] = function(block) { const name = Blockly.Python.valueToCode(block, 'NAME', Blockly.Python.ORDER_NONE) || '"Name"'; const value = Blockly.Python.valueToCode(block, 'VALUE', Blockly.Python.ORDER_NONE) || '"Value"'; const inline = block.getFieldValue('INLINE') === 'TRUE' ? 'True' : 'False'; return `# EMBED_VAR_PLACEHOLDER.add_field(name=${name}, value=${value}, inline=${inline})\n`; };
            Blockly.Python['kick_user'] = function(block) { const user = Blockly.Python.valueToCode(block, 'USER_ID', Blockly.Python.ORDER_NONE) || '0'; const reason = Blockly.Python.valueToCode(block, 'REASON', Blockly.Python.ORDER_NONE) || 'None'; return `\nif 'ctx' in locals() and ctx.guild:\n    _m = ctx.guild.get_member(int(${user}))\n    if _m: await _m.kick(reason=${reason})\n`; };
            Blockly.Python['ban_user'] = function(block) { const user = Blockly.Python.valueToCode(block, 'USER_ID', Blockly.Python.ORDER_NONE) || '0'; const reason = Blockly.Python.valueToCode(block, 'REASON', Blockly.Python.ORDER_NONE) || 'None'; return `\nif 'ctx' in locals() and ctx.guild:\n    _m = ctx.guild.get_member(int(${user}))\n    if _m: await _m.ban(reason=${reason})\n`; };
            Blockly.Python['timeout_user'] = function(block) { const user = Blockly.Python.valueToCode(block, 'USER_ID', Blockly.Python.ORDER_NONE) || '0'; const mins = Blockly.Python.valueToCode(block, 'MINUTES', Blockly.Python.ORDER_NONE) || '5'; return `\nif 'ctx' in locals() and ctx.guild:\n    _m = ctx.guild.get_member(int(${user}))\n    if _m:\n        await _m.timeout(datetime.timedelta(minutes=int(${mins})))\n`; };
            Blockly.Python['add_user_role'] = function(block) { const user = Blockly.Python.valueToCode(block, 'USER_ID', Blockly.Python.ORDER_NONE) || '0'; const role = Blockly.Python.valueToCode(block, 'ROLE_ID', Blockly.Python.ORDER_NONE) || '0'; return `\nif 'ctx' in locals() and ctx.guild:\n    _m = ctx.guild.get_member(int(${user}))\n    _r = ctx.guild.get_role(int(${role}))\n    if _m and _r: await _m.add_roles(_r)\n`; };
            Blockly.Python['remove_user_role'] = function(block) { const user = Blockly.Python.valueToCode(block, 'USER_ID', Blockly.Python.ORDER_NONE) || '0'; const role = Blockly.Python.valueToCode(block, 'ROLE_ID', Blockly.Python.ORDER_NONE) || '0'; return `\nif 'ctx' in locals() and ctx.guild:\n    _m = ctx.guild.get_member(int(${user}))\n    _r = ctx.guild.get_role(int(${role}))\n    if _m and _r: await _m.remove_roles(_r)\n`; };
            Blockly.Python['create_role'] = function(block) { const name = Blockly.Python.valueToCode(block, 'NAME', Blockly.Python.ORDER_NONE) || '"New Role"'; return `\nif 'ctx' in locals() and ctx.guild:\n    await ctx.guild.create_role(name=${name})\n`; };
            Blockly.Python['change_nickname'] = function(block) { const user = Blockly.Python.valueToCode(block, 'USER_ID', Blockly.Python.ORDER_NONE) || '0'; const name = Blockly.Python.valueToCode(block, 'NAME', Blockly.Python.ORDER_NONE) || '"New Nick"'; return `\nif 'ctx' in locals() and ctx.guild:\n    _m = ctx.guild.get_member(int(${user}))\n    if _m: await _m.edit(nick=${name})\n`; };
            Blockly.Python['procedures_defnoreturn'] = Blockly.Python['procedures_defreturn'] = function(block) { const funcName = Blockly.Python.variableDB_.getName(block.getFieldValue('NAME'), Blockly.Names.PROCEDURE_NAME); const branch = getBranchCode(block, 'STACK'); let args = []; for (let i = 0; i < block.arguments_.length; i++) { args.push(Blockly.Python.variableDB_.getName(block.arguments_[i], Blockly.Names.VARIABLE_NAME)); } const argsString = args.join(', '); let returnValue = Blockly.Python.valueToCode(block, 'RETURN', Blockly.Python.ORDER_NONE) || ''; let returnCode = ''; if (block.type === 'procedures_defreturn' && returnValue) { returnCode = `${Blockly.Python.INDENT}return ${returnValue}\n`; } return `\nasync def ${funcName}(${argsString}):\n${branch.trimEnd()}\n${returnCode.trimEnd()}\n`; };
            Blockly.Python['procedures_callnoreturn'] = function(block) { const funcName = Blockly.Python.variableDB_.getName(block.getFieldValue('NAME'), Blockly.Names.PROCEDURE_NAME); const args = []; for (let i = 0; i < block.arguments_.length; i++) { args.push(Blockly.Python.valueToCode(block, 'ARG' + i, Blockly.Python.ORDER_NONE) || 'None'); } return `await ${funcName}(${args.join(', ')})\n`; };
            Blockly.Python['procedures_callreturn'] = function(block) { const funcName = Blockly.Python.variableDB_.getName(block.getFieldValue('NAME'), Blockly.Names.PROCEDURE_NAME); const args = []; for (let i = 0; i < block.arguments_.length; i++) { args.push(Blockly.Python.valueToCode(block, 'ARG' + i, Blockly.Python.ORDER_NONE) || 'None'); } return [`await ${funcName}(${args.join(', ')})`, Blockly.Python.ORDER_FUNCTION_CALL]; };
            Blockly.Python['lists_create_with'] = function(block) { const elements = []; for (let i = 0; i < block.itemCount_; i++) { elements.push(Blockly.Python.valueToCode(block, 'ADD' + i, Blockly.Python.ORDER_NONE) || 'None'); } return ['[' + elements.join(', ') + ']', Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['lists_length'] = function(block) { const list = Blockly.Python.valueToCode(block, 'VALUE', Blockly.Python.ORDER_NONE) || '[]'; return [`len(${list})`, Blockly.Python.ORDER_FUNCTION_CALL]; };
            Blockly.Python['lists_append_to'] = function(block) { const list = Blockly.Python.valueToCode(block, 'LIST', Blockly.Python.ORDER_MEMBER) || '[]'; const item = Blockly.Python.valueToCode(block, 'ITEM', Blockly.Python.ORDER_NONE) || 'None'; return `${list}.append(${item})\n`; };
            Blockly.Python['random_choice'] = function(block) { const list = Blockly.Python.valueToCode(block, 'LIST', Blockly.Python.ORDER_NONE) || '[]'; return [`random.choice(${list})`, Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['lists_getIndex'] = function(block) { const mode = block.getFieldValue('MODE') || 'GET'; const where = block.getFieldValue('WHERE') || 'FROM_START'; const list = Blockly.Python.valueToCode(block, 'VALUE', Blockly.Python.ORDER_MEMBER) || '[]'; let code, at; if (where === 'FROM_START') { at = Blockly.Python.valueToCode(block, 'AT', Blockly.Python.ORDER_ADDITIVE) || '1'; at = Blockly.isNumber(at) ? parseInt(at, 10) - 1 : `(int(${at}) - 1)`; if (mode === 'GET') code = `${list}[${at}]`; else if (mode === 'GET_REMOVE') code = `${list}.pop(${at})`; else if (mode === 'REMOVE') code = `del ${list}[${at}]\n`; } else if (where === 'FROM_END') { at = Blockly.Python.valueToCode(block, 'AT', Blockly.Python.ORDER_UNARY_SIGN) || '1'; at = Blockly.isNumber(at) ? -parseInt(at, 10) : `-int(${at})`; if (mode === 'GET') code = `${list}[${at}]`; else if (mode === 'GET_REMOVE') code = `${list}.pop(${at})`; else if (mode === 'REMOVE') code = `del ${list}[${at}]\n`; } else if (where === 'FIRST') { if (mode === 'GET') code = `${list}[0]`; else if (mode === 'GET_REMOVE') code = `${list}.pop(0)`; else if (mode === 'REMOVE') code = `del ${list}[0]\n`; } else if (where === 'LAST') { if (mode === 'GET') code = `${list}[-1]`; else if (mode === 'GET_REMOVE') code = `${list}.pop()`; else if (mode === 'REMOVE') code = `del ${list}[-1]\n`; } else { return Blockly.Python.lists_getIndex(block); } if (mode === 'REMOVE') return code; return [code, Blockly.Python.ORDER_MEMBER]; };
            Blockly.Python['lists_setIndex'] = function(block) { const mode = block.getFieldValue('MODE') || 'SET'; const where = block.getFieldValue('WHERE') || 'FROM_START'; const list = Blockly.Python.valueToCode(block, 'LIST', Blockly.Python.ORDER_MEMBER) || '[]'; const value = Blockly.Python.valueToCode(block, 'VALUE', Blockly.Python.ORDER_NONE) || 'None'; let code, at; if (where === 'FROM_START') { at = Blockly.Python.valueToCode(block, 'AT', Blockly.Python.ORDER_ADDITIVE) || '1'; at = Blockly.isNumber(at) ? parseInt(at, 10) - 1 : `(int(${at}) - 1)`; if (mode === 'SET') code = `${list}[${at}] = ${value}\n`; else if (mode === 'INSERT') code = `${list}.insert(${at}, ${value})\n`; } else if (where === 'FIRST') { if (mode === 'SET') code = `${list}[0] = ${value}\n`; else if (mode === 'INSERT') code = `${list}.insert(0, ${value})\n`; } else if (where === 'LAST') { if (mode === 'SET') code = `${list}[-1] = ${value}\n`; else if (mode === 'INSERT') code = `${list}.append(${value})\n`; } else if (where === 'FROM_END') { at = Blockly.Python.valueToCode(block, 'AT', Blockly.Python.ORDER_UNARY_SIGN) || '1'; if (mode === 'SET') { const setAt = Blockly.isNumber(at) ? -parseInt(at, 10) : `-int(${at})`; code = `${list}[${setAt}] = ${value}\n`; } else if (mode === 'INSERT') { const insertAt = Blockly.isNumber(at) ? `len(${list}) - ${parseInt(at, 10)}` : `len(${list}) - int(${at})`; code = `${list}.insert(${insertAt}, ${value})\n`; } } else { return Blockly.Python.lists_setIndex(block); } return code; };
            Blockly.Python['random_integer'] = function(block) { const from = Blockly.Python.valueToCode(block, 'FROM', Blockly.Python.ORDER_NONE) || '0'; const to = Blockly.Python.valueToCode(block, 'TO', Blockly.Python.ORDER_NONE) || '100'; return [`random.randint(int(${from}), int(${to}))`, Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['text_replace'] = function(block) { const text = Blockly.Python.valueToCode(block, 'TEXT', Blockly.Python.ORDER_MEMBER) || "''"; const from = Blockly.Python.valueToCode(block, 'FROM', Blockly.Python.ORDER_NONE) || "''"; const to = Blockly.Python.valueToCode(block, 'TO', Blockly.Python.ORDER_NONE) || "''"; return [`str(${text}).replace(str(${from}), str(${to}))`, Blockly.Python.ORDER_MEMBER]; };
            Blockly.Python['text_charAt'] = function(block) { const where = block.getFieldValue('WHERE') || 'FROM_START'; const text = Blockly.Python.valueToCode(block, 'VALUE', Blockly.Python.ORDER_MEMBER) || "''"; let code, at; if (where === 'FROM_START') { at = Blockly.Python.valueToCode(block, 'AT', Blockly.Python.ORDER_ADDITIVE) || '1'; at = Blockly.isNumber(at) ? parseInt(at, 10) - 1 : `(int(${at}) - 1)`; code = `${text}[${at}]`; } else if (where === 'FIRST') { code = `${text}[0]`; } else if (where === 'LAST') { code = `${text}[-1]`; } else if (where === 'FROM_END') { at = Blockly.Python.valueToCode(block, 'AT', Blockly.Python.ORDER_UNARY_SIGN) || '1'; at = Blockly.isNumber(at) ? -parseInt(at, 10) : `-int(${at})`; code = `${text}[${at}]`; } else { code = `${text}[0]`; } return [code, Blockly.Python.ORDER_MEMBER]; };
            Blockly.Python['controls_if'] = function(block) { let code = ''; let condition = Blockly.Python.valueToCode(block, 'IF0', Blockly.Python.ORDER_NONE) || 'False'; let branchCode = getBranchCode(block, 'DO0'); code += `if ${condition}:\n${branchCode}`; for (let i = 1; i <= block.elseifCount_; i++) { condition = Blockly.Python.valueToCode(block, 'IF' + i, Blockly.Python.ORDER_NONE) || 'False'; branchCode = getBranchCode(block, 'DO' + i); code += `elif ${condition}:\n${branchCode}`; } if (block.elseCount_) { branchCode = getBranchCode(block, 'ELSE'); code += `else:\n${branchCode}`; } return code; };
            Blockly.Python['json_load'] = function(block) { const filename = Blockly.Python.valueToCode(block, 'FILENAME', Blockly.Python.ORDER_NONE) || '"data.json"'; return [`_load_json_data(${filename})`, Blockly.Python.ORDER_FUNCTION_CALL]; };
            Blockly.Python['json_save'] = function(block) { const data = Blockly.Python.valueToCode(block, 'DATA', Blockly.Python.ORDER_NONE) || '{}'; const filename = Blockly.Python.valueToCode(block, 'FILENAME', Blockly.Python.ORDER_NONE) || '"data.json"'; return `_save_json_data(${filename}, ${data})\n`; };
            Blockly.Python['dict_create'] = function(block) { return ['{}', Blockly.Python.ORDER_ATOMIC]; };
            Blockly.Python['dict_get'] = function(block) { const dict = Blockly.Python.valueToCode(block, 'DICT', Blockly.Python.ORDER_MEMBER) || '{}'; const key = Blockly.Python.valueToCode(block, 'KEY', Blockly.Python.ORDER_NONE) || '""'; return [`${dict}.get(${key})`, Blockly.Python.ORDER_FUNCTION_CALL]; };
            Blockly.Python['dict_set'] = function(block) { const dict = Blockly.Python.valueToCode(block, 'DICT', Blockly.Python.ORDER_MEMBER) || 'data'; const key = Blockly.Python.valueToCode(block, 'KEY', Blockly.Python.ORDER_NONE) || '""'; const value = Blockly.Python.valueToCode(block, 'VALUE', Blockly.Python.ORDER_NONE) || 'None'; return `${dict}[${key}] = ${value}\n`; };

            // New Generators
            Blockly.Python['on_reaction_add'] = function(block) { const msgId = block.getFieldValue('MESSAGE_ID'); const emoji = block.getFieldValue('EMOJI'); const branch = getBranchCode(block, 'DO'); return `\n@bot.event\nasync def on_raw_reaction_add(payload):\n    if payload.user_id == bot.user.id:\n        return\n    if '${msgId}' and str(payload.message_id) != '${msgId}':\n        return\n    if '${emoji}' and str(payload.emoji) != '${emoji}':\n        return\n    channel = bot.get_channel(payload.channel_id)\n    message = await channel.fetch_message(payload.message_id)\n    user = payload.member or bot.get_user(payload.user_id)\n    ctx = message\n${branch.trimEnd()}\n`; };
            Blockly.Python['send_button_message'] = function(block) { const msg = Blockly.Python.valueToCode(block, 'MESSAGE', Blockly.Python.ORDER_NONE) || '""'; const label = block.getFieldValue('LABEL'); const customId = block.getFieldValue('CUSTOM_ID'); return `\nview = discord.ui.View()\nview.add_item(discord.ui.Button(label="${label}", custom_id="${customId}"))\nif 'ctx' in locals():\n    if isinstance(ctx, discord.Interaction):\n        await ctx.response.send_message(content=${msg}, view=view)\n    else:\n        await ctx.send(content=${msg}, view=view)\n`; };
            Blockly.Python['on_button_click'] = function(block) { const customId = block.getFieldValue('CUSTOM_ID'); const branch = getBranchCode(block, 'DO'); return `\n# BUTTON_EVENT:${customId}\nasync def on_button_${customId}(interaction):\n    ctx = interaction\n    user = interaction.user\n    await interaction.response.defer()\n${branch.trimEnd()}\n`; };
            Blockly.Python['show_modal'] = function(block) { const title = block.getFieldValue('TITLE'); const customId = block.getFieldValue('CUSTOM_ID'); const label1 = block.getFieldValue('LABEL1'); const label2 = block.getFieldValue('LABEL2'); let inputs = `[{"label": "${label1}", "id": "input_0"}]`; if(label2) inputs = `[{"label": "${label1}", "id": "input_0"}, {"label": "${label2}", "id": "input_1"}]`; return `\nif isinstance(ctx, discord.Interaction):\n    await ctx.response.send_modal(EasyModal(title="${title}", custom_id="${customId}", inputs=${inputs}))\n`; };
            Blockly.Python['on_modal_submit'] = function(block) { const customId = block.getFieldValue('CUSTOM_ID'); const branch = getBranchCode(block, 'DO'); return `\n# MODAL_EVENT:${customId}\nasync def on_modal_${customId}(interaction):\n    ctx = interaction\n    user = interaction.user\n    await interaction.response.defer()\n${branch.trimEnd()}\n`; };
            Blockly.Python['get_input_value'] = function(block) { const idx = block.getFieldValue('INDEX'); return [`interaction.data['components'][0]['components'][${idx}]['value']`, Blockly.Python.ORDER_ATOMIC]; };

            return { modernLightTheme, modernDarkTheme };
        };
        
        const html = document.documentElement;
        
        // --- Code Generation & UI Sync ---
        const generatePythonCode = () => {
            if (!workspace) return '';
            let rawCode = Blockly.Python.workspaceToCode(workspace);
            
            // --- Event Handlers for Dynamic Components ---
            let componentEvents = "";
            let modalEvents = "";
            
            // Parse raw code to extract event handlers
            const lines = rawCode.split('\n');
            let filteredLines = [];
            let currentEventName = null;
            let currentEventBody = [];
            
            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];
                if (line.includes('# BUTTON_EVENT:')) {
                    currentEventName = line.split(':')[1].trim();
                    // FIXED: Increased indentation to 12 spaces for if, 16 for await
                    componentEvents += `            if interaction.data.get('custom_id') == '${currentEventName}':\n                await on_button_${currentEventName}(interaction)\n`;
                    filteredLines.push(line); // Keep definition
                } else if (line.includes('# MODAL_EVENT:')) {
                    currentEventName = line.split(':')[1].trim();
                    // FIXED: Increased indentation to 12 spaces for if, 16 for await
                    modalEvents += `            if interaction.data.get('custom_id') == '${currentEventName}':\n                await on_modal_${currentEventName}(interaction)\n`;
                    filteredLines.push(line);
                } else {
                    filteredLines.push(line);
                }
            }
            
            rawCode = filteredLines.join('\n');

            // --- Robust Fallback for Empty Events ---
            // If there are no events, use 'pass' with correct indentation (12 spaces)
            if (!componentEvents.trim()) componentEvents = '            pass';
            if (!modalEvents.trim()) modalEvents = '            pass';

            // --- Optimized Boilerplate ---
            const boilerplate = `
# Easy Discord Bot Builderã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã¾ã—ãŸï¼ è£½ä½œï¼š@himais0giiiin
# Created with Easy Discord Bot Builder! created by @himais0giiiin!
# Optimized Version

import discord
from discord import app_commands
from discord.ext import commands
from discord import ui
import random
import asyncio
import datetime
import math
import json
import os
import logging

# ãƒ­ã‚®ãƒ³ã‚°è¨­å®š (Logging Setup)
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')

intents = discord.Intents.default()
intents.message_content = True 
intents.members = True 

# Botã®ä½œæˆ
bot = commands.Bot(command_prefix='!', intents=intents)

# ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
@bot.event
async def on_command_error(ctx, error):
    if isinstance(error, commands.CommandNotFound):
        return
    logging.error(f"Command Error: {error}")

# ---JSONæ“ä½œ---
def _load_json_data(filename):
    if not os.path.exists(filename):
        return {}
    try:
        with open(filename, 'r', encoding='utf-8') as f:
            return json.load(f)
    except Exception as e:
        logging.error(f"JSON Load Error: {e}")
        return {}

def _save_json_data(filename, data):
    try:
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=4)
    except Exception as e:
        logging.error(f"JSON Save Error: {e}")

# --- ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¯ãƒ©ã‚¹ ---
class EasyModal(discord.ui.Modal):
    def __init__(self, title, custom_id, inputs):
        super().__init__(title=title, timeout=None, custom_id=custom_id)
        for item in inputs:
            self.add_item(discord.ui.TextInput(label=item['label'], custom_id=item['id']))

# --- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ ---
@bot.event
async def on_interaction(interaction):
    try:
        if interaction.type == discord.InteractionType.component:
${componentEvents}
        elif interaction.type == discord.InteractionType.modal_submit:
${modalEvents}
    except Exception as e:
        print(f"Interaction Error: {e}")

# ----------------------------

# --- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆéƒ¨åˆ† ---
${rawCode}
# --------------------------

if __name__ == "__main__":
    # Token check
    # bot.run('TOKEN') # å®Ÿè¡Œæ™‚ã¯ã“ã“ã«Tokenã‚’å…¥ã‚Œã¦ãã ã•ã„!
    pass
`;
            return boilerplate.trim();
        };

        const updateLivePreview = () => {
            const code = generatePythonCode();
            const preview = document.getElementById('codePreviewContent');
            preview.textContent = code;
            hljs.highlightElement(preview);
        };

        const toggleTheme = (modernLightTheme, modernDarkTheme) => {
            const currentTheme = html.classList.contains('dark') ? 'dark' : 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.classList.remove(currentTheme);
            html.classList.add(newTheme);
            localStorage.setItem('theme', newTheme);
            if (workspace) {
                workspace.setTheme(newTheme === 'dark' ? modernDarkTheme : modernLightTheme);
            }
        };

        const initializeApp = () => {
            const { modernLightTheme, modernDarkTheme } = setupBlocklyEnvironment();

            const blocklyDiv = document.getElementById('blocklyDiv');
            const toolbox = document.getElementById('toolbox');
            const themeToggle = document.getElementById('themeToggle');
            // ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒœã‚¿ãƒ³
            const showCodeBtn = document.getElementById('showCodeBtn');
            // ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£
            const codeModal = document.getElementById('codeModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const codeOutput = document.getElementById('codeOutput');
            const copyCodeBtn = document.getElementById('copyCodeBtn');

            const importBtn = document.getElementById('importBtn');
            const exportBtn = document.getElementById('exportBtn');
            const importInput = document.getElementById('importInput');
            const workspaceContainer = document.getElementById('workspace-container');
            const layoutBlockBtn = document.getElementById('layoutBlockBtn');
            const layoutSplitBtn = document.getElementById('layoutSplitBtn');
            
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') html.classList.add('dark');
            const initialTheme = savedTheme === 'dark' ? modernDarkTheme : modernLightTheme;

            // --- ãƒ‘ãƒ¬ãƒƒãƒˆå›ºå®šåŒ–ã®å¼·åˆ¶é©ç”¨ (Zoom Fix) ---
            // ãƒ•ãƒ©ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆãƒ‘ãƒ¬ãƒƒãƒˆï¼‰ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚’å¸¸ã«1ã«å›ºå®šã™ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
            Blockly.VerticalFlyout.prototype.getFlyoutScale = function() {
                return 1;
            };

            workspace = Blockly.inject(blocklyDiv, {
                toolbox: toolbox,
                horizontalLayout: false,
                trashcan: true,
                zoom: { 
                    controls: true, 
                    wheel: true, 
                    startScale: 1.0, 
                    maxScale: 3, 
                    minScale: 0.3, 
                    scaleSpeed: 1.2 
                },
                renderer: 'zelos',
                theme: initialTheme
            });

            // --- ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆãƒ•ãƒ©ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ã®å›ºå®šè¨­å®š ---
            if (workspace.getToolbox()) {
                const flyout = workspace.getToolbox().getFlyout();
                if (flyout) {
                    flyout.autoClose = false;
                }
            }

            // --- Layout Switching Logic ---
            const setLayout = (mode) => {
                if (mode === 'split') {
                    workspaceContainer.classList.add('split-view');
                    layoutSplitBtn.classList.remove('text-slate-500', 'dark:text-slate-400');
                    layoutSplitBtn.classList.add('bg-white', 'dark:bg-slate-800', 'shadow-sm', 'text-indigo-600', 'dark:text-indigo-400');
                    
                    layoutBlockBtn.classList.remove('bg-white', 'dark:bg-slate-800', 'shadow-sm', 'text-indigo-600', 'dark:text-indigo-400');
                    layoutBlockBtn.classList.add('text-slate-500', 'dark:text-slate-400');
                    updateLivePreview();
                } else {
                    workspaceContainer.classList.remove('split-view');
                    layoutBlockBtn.classList.remove('text-slate-500', 'dark:text-slate-400');
                    layoutBlockBtn.classList.add('bg-white', 'dark:bg-slate-800', 'shadow-sm', 'text-indigo-600', 'dark:text-indigo-400');
                    
                    layoutSplitBtn.classList.remove('bg-white', 'dark:bg-slate-800', 'shadow-sm', 'text-indigo-600', 'dark:text-indigo-400');
                    layoutSplitBtn.classList.add('text-slate-500', 'dark:text-slate-400');
                }
                setTimeout(() => Blockly.svgResize(workspace), 350);
            };

            layoutBlockBtn.addEventListener('click', () => setLayout('block'));
            layoutSplitBtn.addEventListener('click', () => setLayout('split'));

            // --- Realtime Sync ---
            workspace.addChangeListener((e) => {
                // UIã‚¤ãƒ™ãƒ³ãƒˆä»¥å¤–ã§æ›´æ–°
                if (e.type !== Blockly.Events.UI && workspaceContainer.classList.contains('split-view')) {
                    updateLivePreview();
                }
                
                // Auto Save
                if (!e.isUiEvent && e.type !== Blockly.Events.FINISHED_LOADING) {
                    const xml = Blockly.Xml.workspaceToDom(workspace);
                    localStorage.setItem(STORAGE_KEY, Blockly.Xml.domToText(xml));
                    const saveStatus = document.getElementById('saveStatus');
                    saveStatus.setAttribute('data-show', 'true');
                    setTimeout(() => saveStatus.setAttribute('data-show', 'false'), 2000);
                }
            });

            // --- Toolbox Pin Button (Re-implementation) ---
            const pinBtn = document.createElement('button');
            pinBtn.id = 'toolboxPinBtn';
            pinBtn.className = 'absolute z-20 p-2 rounded-lg text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 dark:text-slate-500 dark:hover:text-indigo-400 dark:hover:bg-indigo-900/30 transition-all duration-200 shadow-sm border border-transparent hover:border-indigo-100 dark:hover:border-indigo-900/50';
            pinBtn.style.top = '12px';
            
            const updatePinState = () => {
                if (!workspace) return;
                const toolbox = workspace.getToolbox();
                if (!toolbox) return;
                
                let isVisible = true;
                if (typeof toolbox.isVisible === 'function') {
                    isVisible = toolbox.isVisible();
                } else if (typeof toolbox.getWidth === 'function') {
                    isVisible = toolbox.getWidth() > 0;
                }
                
                const width = (typeof toolbox.getWidth === 'function') ? toolbox.getWidth() : 0;
                
                if (isVisible) {
                    pinBtn.style.left = `${width - 38}px`;
                    pinBtn.innerHTML = '<i data-lucide="pin" class="w-3.5 h-3.5 fill-indigo-500 text-indigo-600"></i>';
                    pinBtn.classList.add('bg-white', 'dark:bg-slate-800');
                } else {
                    pinBtn.style.left = '12px';
                    pinBtn.innerHTML = '<i data-lucide="pin-off" class="w-3.5 h-3.5"></i>';
                    pinBtn.classList.remove('bg-white', 'dark:bg-slate-800');
                    pinBtn.classList.add('bg-white/80', 'dark:bg-slate-800/80', 'backdrop-blur-sm');
                }
                lucide.createIcons();
            };

            pinBtn.onclick = () => {
                const toolbox = workspace.getToolbox();
                if (!toolbox) return;
                const isVisible = typeof toolbox.isVisible === 'function' ? toolbox.isVisible() : (toolbox.getWidth() > 0);
                if (typeof toolbox.setVisible === 'function') toolbox.setVisible(!isVisible);
                Blockly.svgResize(workspace);
                setTimeout(updatePinState, 50); 
            };
            document.getElementById('blocklyDiv').appendChild(pinBtn);
            setTimeout(updatePinState, 100);
            window.addEventListener('resize', () => { Blockly.svgResize(workspace); updatePinState(); });
            workspace.addChangeListener((e) => { if (e.type === Blockly.Events.TOOLBOX_ITEM_SELECT) setTimeout(updatePinState, 50); });

            // --- Load Saved Data ---
            const xmlText = localStorage.getItem(STORAGE_KEY);
            if (xmlText) {
                try {
                    Blockly.Xml.clearWorkspaceAndLoadFromXml(Blockly.Xml.textToDom(xmlText), workspace);
                } catch (e) { console.error(e); }
            }

            themeToggle.addEventListener('click', () => toggleTheme(modernLightTheme, modernDarkTheme));
            
            importBtn.addEventListener('click', () => importInput.click());
            importInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        Blockly.Xml.clearWorkspaceAndLoadFromXml(Blockly.Xml.textToDom(e.target.result), workspace);
                    } catch (err) { console.error(err); }
                };
                reader.readAsText(file);
                e.target.value = '';
            });

            exportBtn.addEventListener('click', () => {
                const xml = Blockly.Xml.workspaceToDom(workspace);
                const blob = new Blob([Blockly.Xml.domToText(xml)], {type: 'text/xml'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `bot-project.xml`;
                a.click();
                URL.revokeObjectURL(url);
            });
            
            // --- ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ (ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ã) ---
            showCodeBtn.addEventListener('click', () => {
                codeOutput.textContent = generatePythonCode();
                codeModal.classList.remove('hidden');
                codeModal.classList.add('flex');
                // Force reflow
                void codeModal.offsetWidth;
                codeModal.classList.add('show-modal');
            });

            closeModalBtn.addEventListener('click', () => {
                codeModal.classList.remove('show-modal');
                setTimeout(() => {
                    codeModal.classList.remove('flex');
                    codeModal.classList.add('hidden');
                }, 300); // Wait for transition
            });
            
            copyCodeBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(codeOutput.textContent);
                const originalHtml = copyCodeBtn.innerHTML;
                copyCodeBtn.innerHTML = '<i data-lucide="check" class="w-3.5 h-3.5"></i> ã‚³ãƒ”ãƒ¼å®Œäº†';
                copyCodeBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-500');
                copyCodeBtn.classList.add('bg-emerald-600', 'hover:bg-emerald-500', 'border-emerald-400');
                lucide.createIcons();
                
                setTimeout(() => {
                    copyCodeBtn.innerHTML = originalHtml;
                    copyCodeBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-500');
                    copyCodeBtn.classList.remove('bg-emerald-600', 'hover:bg-emerald-500', 'border-emerald-400');
                    lucide.createIcons();
                }, 2000);
            });
        };

        window.onload = initializeApp;
    </script>
</body>
</html>